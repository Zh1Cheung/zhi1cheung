------------------------------------
title: iptables实现七层访问过滤，SNAT与DNAT，DNS-View的实现  
categories:
- Web Services 
tags:
- iptables

-------------------------------------------------------------------





iptables防火墙是工作在网络层，针对TCP/IP数据包实施过滤和限制，属于典型的包过滤防火墙。以基于网络层的数据包过滤机制为主，同时提供少量的传输层、数据链路层的过滤功能。难以判断数据包对应于何种应用程序(如:QQ、迅雷等)

   安装netfilter-layer7补丁包的作用是为Linux内核、iptables添加相应的补丁文件，重新编译安装后提供基于应用层(第7层)的扩展功能。通过独立的l7-protocols协议包提供对各种应用层协议的特征识别与定义，便于更新

  

## 一、编译内核，使之防火墙支持7层过滤**

本实验采用的安装包

    #netfilter-layer7-v2.23.tar.bz2 //netfilter-layer7补丁包
    #iptables-1.4.20.tar.bz2     //iptables包
    #l7-protocols-2009-05-28.tar.gz  //iptables支持的应用层协议包

  

**1、获取并编译内核**

    [root@station34 ~]# useradd mockbuild //添加安装src格式的软件包需要的用户
    [root@station34 ~]# rpm -ivh kernel-2.6.32-431.5.1.x86_64.el6.src.rpm
    [root@station34 ~]# cd rpmbuild/SOURCES
    [root@station34 SOURCES]# tar linux-2.6.32-*.tar.gz -C /usr/src
    [root@station34 SOURCES]# cd /usr/src
